<div class="flex">
  <div>
    <h1><%= r.name %></h1>
  </div>
</div>

<% const total = r.usgnUsers + r.steamUsers %>
<div class="bar">
  <div><span>Updated</span><span><%= timeAgo(r.ts) %></span></div>
  <div>
    <span>USGN Users</span>
    <span><%= r.usgnUsers %> (<%= total ? ((r.usgnUsers / total) * 100).toFixed(1) : 0 %>%)</span>
  </div>
  <div>
    <span>Steam Users</span>
    <span><%= r.steamUsers %> (<%= total ? ((r.steamUsers / total) * 100).toFixed(1) : 0 %>%)</span>
  </div>
  <div>
    <span>Ranked Users</span>
    <span><%= total %></span>
  </div>
  <a href="/details/<%= addr %>"><span>Server Details</span><span>Visit Page</span></a>
</div>

<div class="responsive">
  <table class="leaderboard sortable">
    <thead>
      <tr>
        <th aria-sort="ascending">#</th>
        <th>Player</th>
        <th><abbr title="Kills per Death">K/D</abbr></th>
        <th><abbr title="Kills">K</abbr></th>
        <th><abbr title="Assists">A</abbr></th>
        <th><abbr title="Deaths">D</abbr></th>
        <th><abbr title="MVPs">⭐</abbr></th>
        <th><abbr title="Time Played">⌚</abbr></th>
      </tr>
    </thead>
    <tbody>
      <% r.players.forEach((p, i) => { %>
        <% const profileUrl = p.usertype === 1 
          ? `https://steamcommunity.com/profiles/${p.userid}` 
           : `https://unrealsoftware.de/profile.php?userid=${p.userid}` %>
        
        <% const kdRatio = p.deaths > 0 
          ? (p.kills / p.deaths).toFixed(2) 
          : (p.kills).toFixed(2) %>

        <tr>
          <td class="<%= i < 3 ? 'medal' : '' %>">
            <%= i === 0 ? '🥇' : i === 1 ? '🥈' : i === 2 ? '🥉' : (i + 1) %>
          </td>
          <td><a href="<%= profileUrl %>" target="_blank"><%= p.name %></a></td>
          <td><%= kdRatio %></td>
          <td><%= p.kills %></td>
          <td><%= p.assists %></td>
          <td><%= p.deaths %></td>
          <td><%= p.mvps %></td>
          <td data-sort="<%= p.time %>"><%= formatTime(p.time) %></td>
        </tr>
      <% }) %>
    </tbody>
  </table>
</div>
